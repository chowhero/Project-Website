<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="apple-touch-icon" sizes="180x180" href="./image/downloadfile.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./image/downloadfile.png">
    <title>United States Army Roleplay Roblox</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="staff.css">

    <script>
    // å¢å¼ºç‰ˆåˆå§‹åŒ–è„šæœ¬
    document.addEventListener('DOMContentLoaded', function() {
        // 1. æ¸…é™¤Service Workerç¼“å­˜
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(regs => {
                regs.forEach(reg => reg.unregister());
                caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => caches.delete(cacheName));
                });
            });
        }

        // 2. æ£€æŸ¥URLå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const fromLogout = urlParams.has('fromLogout');
        const forceClear = urlParams.has('forceClear');

        // 3. å¼ºåˆ¶æ¸…é™¤æ¨¡å¼
        if (forceClear) {
            localStorage.clear();
            sessionStorage.clear();
            history.replaceState({}, '', location.pathname);
            return;
        }

        // 4. å¤„ç†ç™»å‡ºåçš„çŠ¶æ€
        if (fromLogout) {
            localStorage.removeItem('staffAuth');
            sessionStorage.setItem('logoutTimestamp', Date.now());
            history.replaceState({}, '', location.pathname);
            return;
        }

        // 5. ç™»å½•çŠ¶æ€æ£€æŸ¥ï¼ˆå¸¦5ç§’å†·å´æ—¶é—´ï¼‰
        try {
            const authData = JSON.parse(localStorage.getItem('staffAuth'));
            const logoutTime = sessionStorage.getItem('logoutTimestamp');
            
            // å†·å´æœŸæ£€æŸ¥ï¼ˆ5ç§’å†…ä¸å…è®¸è‡ªåŠ¨è·³è½¬ï¼‰
            const isInCooldown = logoutTime && (Date.now() - logoutTime < 5000);
            
            if (authData?.id && !isInCooldown) {
                setTimeout(() => {
                    window.location.replace(`staff.html?from=index&r=${Math.random()}`);
                }, 100);
            }
        } catch(e) {
            localStorage.removeItem('staffAuth');
        }
    });
    </script>
     <title>Announcement</title>
    <style>
        .announcement {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <header>
        <div class="title-group">
            <h1>United States Army Roleplay</h1>
        </div>

        <nav>
            <a href="index.html" class="home-btn">Home</a>
            <a href="ownership.html" class="owner-btn">Ownership</a>
            <a href="specialthanks.html" class="special-btn">Special-Thanks</a>
            <a href="gamepasses.html" class="gamepasses-btn">Game-Passes</a>
            <a href="application.html" class="career-btn">Career</a>
            <a href="login.html" class="login-btn">Staff</a>
        </nav>
    </header>

    <!-- Staff Login Modal -->
    <div id="staffLoginModal" class="login-modal">
        <div class="login-container">
            <span class="close-modal">&times;</span>
            <h2>Staff Login</h2>
            <form id="staffLoginForm">
                <input type="text" id="staffId" placeholder="Staff ID" required>
                <input type="password" id="staffPassword" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
        </div>
    </div>

    <div class="container">
        <div id="home" class="page active">
            <h2>Welcome to United States Roleplay</h2>
            <p>Try the realistic army life now! Uh.. Still in development now...</p>
            
    <h1>ğŸ“¢ Announcement</h1>
    <div id="announcement-list"></div>
    <div id="announcements-container"></div>

    <script>
        // å¾ localStorage è®€å–å…¬å‘Š
        function loadAnnouncements() {
    const announcements = JSON.parse(localStorage.getItem('announcements') || []);
    const list = document.getElementById('announcement-list');
    list.innerHTML = '';
    
    announcements.forEach((ann, index) => {
        list.innerHTML += `
            <div style="border:1px solid #ddd; padding:10px; margin:5px;">
                <strong>${ann.title}</strong>
                <p>${ann.content}</p>
                <small>${ann.date}</small>
            </div>
        `;
    });
}

// é é¢åŠ è¼‰æ™‚è‡ªå‹•é¡¯ç¤º
loadAnnouncements();
    </script>
        </div>

<script>
// å¾å¾Œç«¯ç²å–å…¬å‘Š
fetch('/api/announcements')
    .then(res => res.json())
    .then(announcements => {
        const container = document.getElementById('announcements-container');
        announcements.forEach(ann => {
            container.innerHTML += `
                <div class="announcement ${ann.priority}">
                    <h3>${ann.title}</h3>
                    <p>${ann.content}</p>
                    <small>${new Date(ann.created_at).toLocaleString()}</small>
                </div>
            `;
        });
    });
</script>

            <div id="countdown">
                <h3>Game Release Countdown</h3>
                <div id="timer">
                    <span id="years">0</span>Y <span id="months">0</span>M 
                    <span id="days">0</span>D <span id="hours">0</span>H
                    <span id="minutes">0</span>Min <span id="seconds">0</span>Sec
                </div>
                <div class="countdown-subtext">T-MINUS TO LAUNCH</div>
            </div>
        </div>
    </div>

    <footer>
        <div class="social-links">
            <a href="https://discord.gg/955rtqFWBw" class="social-icon discord"><i class="fa-brands fa-discord"></i></a>
            <a href="https://youtube.com/@robloxusarmyofficial?si=mxcgPo4eox4a0N4h" class="social-icon youtube"><i class="fa-brands fa-youtube"></i></a>
            <a href="https://www.roblox.com/share/g/32798597" class="social-icon twitter"><i class="fa-solid fa-gamepad"></i></a>
        </div>
        <p>&copy; 2025 United States Army Roleplay | Roblox. All rights reserved.</p>
        <p><small>This is a fan-made game, not affiliated with the actual US military</small></p>
    </footer>

    <!-- è„šæœ¬åŠ è½½ -->
    <script src="js/staff/staff-auth.js"></script>
    <script src="js/staff/utils.js"></script>
    <script src="js/main.js"></script>
    <script src="js/script.js"></script>
    <script src="/js/staff/function/staff-announcements.js"></script>
</body>
</html>
